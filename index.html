<html>
    <head>
        <script src="font_awesome.js"></script>
        <style>
            .av{
                --border-width: 3px;
                --radius:50px;
                background-color:white;
                height:var(--radius);
                width:var(--radius);
                border-radius:var(--radius);
                margin: 20 20 10 20;
                display: flex;
                position:relative;
     
            }
            .elem {
                --border-width: 3px;
                    position: absolute;
                    content: "";
                    top: calc(-1 * var(--border-width));
                    left: calc(-1 * var(--border-width));
                    z-index: -1;
                    width: calc(100% + var(--border-width) * 2);
                    height: calc(100% + var(--border-width) * 2);
                    background: linear-gradient(
                      60deg,
                      hsl(224, 85%, 66%),
                      hsl(269, 85%, 66%),
                      hsl(314, 85%, 66%),
                      hsl(359, 85%, 66%),
                      hsl(44, 85%, 66%),
                      hsl(89, 85%, 66%),
                      hsl(134, 85%, 66%),
                      hsl(179, 85%, 66%)
                    );
                    background-size: 300% 300%;
                    background-position: 0 50%;
                    border-radius: calc(2 * var(--radius));
                    animation: moveGradient 4s alternate infinite;
                  }
                @keyframes moveGradient {
                  50% {
                    background-position: 100% 50%;
                  }
                                
            }
        </style>
    </head>

    <body>
        <div id="curr" style='
        position:relative;
        z-index:0;
        background-color:rgb(6,9,15);
        height:100px;
        width:max-content;
        display:flex;
        overflow-x:scroll;
        '>
        <div><div id="myAvatar" class="av"></div></div>
        <div><div class="av"><div class="elem"></div></div></div>
        <div><div class="av"><div class="elem"></div></div></div>
        <div><div class="av"><div class="elem"></div></div></div>
        <div><div class="av"></div></div>
        <div><div class="av"></div></div>
        <div><div class="av"></div></div>
        <div><div class="av"></div></div>
        <div><div class="av"></div></div>
        <div><div class="av"></div></div>
        <div><div class="av"></div></div>
        <div><div class="av"></div></div>
        <div><div class="av"></div></div>
        <div><div class="av"></div></div>
        <div><div class="av"></div></div>
        <div><div class="av"></div></div>
        <div><div class="av"></div></div>
        <div><div class="av"></div></div>
        <div><div class="av"></div></div>
        <div><div class="av"></div></div>

        <div><div class="av"></div></div>
        <div><div class="av"></div></div>

        <div><div class="av"></div></div>
        <div><div class="av"></div></div>
       
        <form method="POST" action="server">
        <input type="file" id="file1" style="display:none">
        </form>
        </div>
      
        <script src="jquery.js"></script>



        <script>
            timeoutId=0;
            counter1=0;
            counter2=0;
            oldBody="";
            $(document).on('click','#closeIcon',()=>{
                console.log("I am being pressed");
              /*  while(timeoutId--)
                {
                    window.clearTimeout(timeoutId);
                   
                }
                console.log(oldBody);
                $('body').html(oldBody);*/
               location.reload();
             })
            $('.av').on("click",function(){
                ind=$(this).parent().parent().children().index($(this).parent())-1;
                console.log("Story clikced");
                console.log(ind);
                //Show all stories starting from this index in dictionary
                data=[
                {
                    "name":"aryan29",
                    "story":[
                    "https://image.shutterstock.com/image-photo/home-office-dress-code-girl-600w-1719984745.jpg",
                    
                    ]
                },
                {
                    "name":"img",
                    "story":[
                    "https://image.shutterstock.com/image-photo/black-steel-large-anchor-chain-600w-1081708619.jpg",
                    "https://image.shutterstock.com/image-photo/home-office-dress-code-girl-600w-1719984745.jpg",
                    ]
                },
                {
                    "name":"hello",
                    "story":[
                    "https://image.shutterstock.com/image-photo/home-office-dress-code-girl-600w-1719984745.jpg",
                    ]
                },
                {
                    "name":"world",
                    "story":[
                    "https://image.shutterstock.com/image-photo/home-office-dress-code-girl-600w-1719984745.jpg",
                    ]
                }

                ]
                showStories(ind,data);

            })
            showStories=()=>{
                console.log("Coming to show stroies");
                oldBody=$('body').html();
                $('body').css({
                    "display": "flex",
                    "height": "100vh",
                    "margin": "0",
                    "justify-content": "center",
                    "background": "rgb(56,56,56)"
               
                })
                console.log("Coming to show stories");
                let name=data[0]['name']
                let elem=document.createElement("div");
                let userProf=document.createElement('div');
                let img=document.createElement("div");
                let leftButton=document.createElement('button');
                let rightButton=document.createElement('button');
                leftButton.id="moveLeft";
                rightButton.id="moveRight";
                $(leftButton).append('<i class="fas fa-chevron-left"></i>');
                $(rightButton).append('<i class="fas fa-chevron-right"></i>');
                let currentTimeout=0;

                let wait=250000;
                (function repeat(data,i,j,immediate){
                    wait=(immediate==true)?0:250000;
                    console.log("Before Loop coming",i,j);
                    //////////////////////////////////////////////////=>Origin Indexes
                    if(j<0)
                    {
                        i-=1;
                        if(i>=0)
                        {
                        if(data[i]['story'].length>=-1*j)
                            j=data[i]['story'].length+j;
                        else
                        {
                            i-=1;
                            if(i>=0)
                            j=data[i]['story'].length-1;
                        }
                        }
                    }
                    if(i>=0 && i<data.length && j>=data[i]['story'].length){
                        i+=1;
                        j=0;
                    }
                    //////////////////////////////////////////////////////////////////
                    console.log("After Loop coming",i,j);
                    $("#moveLeft").on("click",()=>{
                        //Cancel the current timeout and go to next
                        console.log("Key press current timeout",currentTimeout);
                        clearTimeout(currentTimeout);
                       repeat(data,i,j-2,true);
                       return;
                    });
                    $("#moveRight").on("click",()=>{
                        //Cancel the current timeout and go to next
                        console.log("Key press current timeout",currentTimeout);
                        clearTimeout(currentTimeout);
                       repeat(data,i,j,true);
                       return;
                    });
                   //////////////////////////////////////////////////////////Terminating Conditions
                   if(i>=data.length || i<=-1)
                   {
                       console.log(immediate);
                       setTimeout(()=>{$('#closeIcon').click()},wait)
                       console.log("Lets end this",wait);
                       return;
                   }
               //////////////////////////////////////////////////////////


                   currentTimeout=setTimeout(function(){
                    console.log("Inside set timeout");
                    console.log(i,j);
                    name=data[i]['name'];
                    $(elem).html('')
                    $(userProf).html('')
                    $(img).html('')
                    $(elem).css({
                        "height": "80%",
                        "width": "80%",
                        "margin": "0",
                        "background":"black",
                    })
                    $(userProf).css({
                        "height": "5%",
                        "width": "100%",
                        "top": 0,
                        "left": 0,
                        "position": "relative",
                        "background-color": "rgb(26,26,26)",
                        "display": "flex",
                        "justify-content": "flex-start",
                        "color": "white",
                        "align-items": "center"

                    });
                    $(userProf).append('<div style="margin:auto;max-height:80%;margin-left:20px;margin-right:20px;width:40px;height:40px;border-radius:40px;background:black;background-position:center;background-size:cover"></div>');
                    $(userProf).append('<div><h3>aryan29</h3></div>');
                    var closeIcon=$('<i id="closeIcon" class="fas fa-times-circle fa-5x" style="font-size:20px;color:red;margin-left:auto;margin-right:10px"></i>')
                    $(userProf).append(closeIcon);
                    $(elem).html(userProf);
                    $(elem).append(img);

                    //Adding image to elem
                    $(img).css({
                        "background-image": "url(http://127.0.0.1:5500/" + data[i]['stories'][j] + ")",
                        "background-position": "center",
                        "background-size": "contain",
                        "background-repeat": "no-repeat",
                        "width": "100%",
                        "height": "90%",
                        "margin-top": "15px"
                    });
                    $(leftButton).css({
                        "height":"80%",
                        "width":"30px",
                        "color":"black",
                        "margin":"0"
                    })
                    $(rightButton).css({
                        "height":"80%",
                        "width":"30px",
                        "color":"black",
                        "margin":"0"
                    })  
                    
                   // console.log(elem);
                  
                    $('body').empty();
                    $('body').append(leftButton);
                    $('body').append(elem);
                    $('body').append(rightButton);

                    repeat(data,i,j+1,false);
                    console.log("Current Timeout",currentTimeout);
                },wait)
            })(data,0,0,true)
            
        
        }


            $('#myAvatar').on("click",()=>{
                document.getElementById("file1").click();
            });
            $("#file1").on("change",()=>{
                myfile=$('#file1');
                console.log(myfile[0].files[0]);

            let formData=new FormData();
            console.log("File submitted");
            let file=myfile[0].files[0];
            formData.append('file',file);
            //Send Ajax request to the server
            $.ajax({
                url:"http://127.0.0.1:5000/upload",
                type:"post",
                data:formData,
                processData:false,
                contentType:false,
                success:(res)=>console.log(res),
                error:(...err)=>console.log(err)
            })
            })


              
        </script>
    </body>

</html>